@page "/Artistas"
@inject ArtistaAPI artistaAPI


<MudStack Class="mt-4 mb-4" Row="true" Justify="Justify.SpaceBetween">
    <MudText Class="mb-4" Typo="Typo.h4">
        Artistas cadastrados
    </MudText>
    <MudPagination Count="@totalPaginas" SelectedChanged="PaginaMudou">
    </MudPagination>
</MudStack>

@if (artistasPorPagina is not null)
{
    <MudGrid>
        @foreach (var artista in artistasPorPagina)
    {
        <MudItem xs="3">
            <CardArtista Artista="artista"/>
        </MudItem>
    }
    </MudGrid>
}


@code {
    //ATRIBUTOS - CAMPOS
    private ICollection<ArtistaResponse>? artistas;

    //PARA PAGINAÇÃO
    private int tamanho = 8;//ITENS POR PÁGINA
    private int totalItens;
    private int totalPaginas;
    private ICollection<ArtistaResponse>? artistasPorPagina;


    //DEMAIS MÉTODOS

    //SOBRECARGA DO MÉTODO OnInitializedAsync PARA QUE, SEMPRE QUE A ROTA Artistas
    //FOR CONSULTADA, A COLEÇÃO artistas VAI RECEBER O RESULTADO DE 
    // artistaAPI.GetArtistasAsync(), QUE FOI DEFINIDA EM ArtistaAPI.cs
    //PAGINADO
    protected override async Task OnInitializedAsync()
    {
        artistas = await artistaAPI.GetArtistasAsync();

        //PARA PAGINAÇÃO
        if(artistas is not null)
        {
            //ORDENAÇÃO PELOS MAIS RECENTES
            artistas = artistas.OrderByDescending(a => a.Id).ToList();
            totalItens = artistas.Count();
            totalPaginas = Convert.ToInt32(Math.Ceiling((totalItens * 1.0)/tamanho));
            this.PaginaMudou(1);
        }
    }

    private void PaginaMudou(int pageNumber)
    {
        var indice = pageNumber - 1;
        artistasPorPagina = artistas!
        .Skip(tamanho * indice)
        .Take(tamanho)
        .ToList();
    }

    /*
     OBSERVAÇÕES
     OU SEJA, SEMPRE QUE ACESSADO A ROTA Artistas
     É MOSTRADO NA TELA A LISTAGEM DE ARTISTAS - MÉTODO app.MapGet("Artistas") DA API

     <MudItem xs="3"> - DEFINE QUE PAR CADA LINHA, HAVERÁ 3 ESPAÇOS ENTRE, OS ITENS,
     OU SEJA, 4 ITENS

     <CardArtista Artista="artista"/> - O ITEM CardArtista RECEBE A VARIÁVEL
     artista, USANDO PARÂMETRO Artista EM CADA REPETIÇÃO
     */
    
}



